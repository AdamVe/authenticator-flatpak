app-id: com.yubico.yubioath
runtime: org.gnome.Platform
runtime-version: '46'
sdk: org.gnome.Sdk
command: authenticator
finish-args:
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pcsc
  # key ring
  - --socket=session-bus
  # access to FIDO protocol
  - --device=all
  # save iconpacks locally
  # - --filesystem=home:rw
  # - --filesystem=xdg-config:rw
  # - --filesystem=xdg-cache:rw
  # - --filesystem=xdg-data:rw
modules:
  - name: pcsc-lite
    config-opts:
      - --disable-libudev
      - --disable-libsystemd
      - --without-systemdsystemunitdir
      - --disable-serial
      - --disable-usb
      - --disable-documentation
      - --disable-polkit
    cleanup:
      - '/include'
      - '/bin/pcsc-spy'
      - '/lib/libpcscspy*'
      - '/lib/pkg-config'
      - '/share/doc'
      - '/share/man'
    post-install:
      - rm /app/sbin/pcscd
      - rmdir /app/sbin || true
    sources:
      - type: archive
        url: https://pcsclite.apdu.fr/files/pcsc-lite-2.2.1.tar.xz
        sha256: 625edcd6cf4b45af015eb5b6b75ea47f8914e892774c67e1079c9553c8665a57
  - name: zenity
    buildsystem: meson
    sources:
      - type: archive
        url: https://download.gnome.org/sources/zenity/4.0/zenity-4.0.1.tar.xz
        sha256: 0c2f537813b10f728470d9d05d6c95713db2512f9c95096e1e85b1a6739605e6
  - name: gnome-screenshot
    buildsystem: meson
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gnome-screenshot/41/gnome-screenshot-41.0.tar.xz
        sha256: 4adb7dec926428f74263d5796673cf142e4720b6e768f5468a8d0933f98c9597
      - type: patch
        path: patch/0001-gnome-screenshot-meson-fix.patch
  - name: yubico_authenticator
    buildsystem: simple
    build-commands:
      - install -D authenticator /app/bin/authenticator
      - cp -R data helper lib /app/bin/
    sources:
      - type: archive
        url: https://developers.yubico.com/yubioath-flutter/Releases/yubico-authenticator-7.0.0-linux.tar.gz
        sha256: ec6bdca21ffabb0565d0d63f3e5525953dbb98b7ac2263bacea3770a18555ee5
